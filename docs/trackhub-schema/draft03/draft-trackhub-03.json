{
  "$schema": "http://json-schema.org/draft-04/schema#",

  "title": "TrackHub Schema",

  "description" : "The schema which describes valid TrackHub JSON documents.",

  "type": "object",

  "properties": {
    "name": { "type": "string" },

    "description": { "type": "string" },

    "version": { "type": "string" },

    "data": {
      "type": "array",

      "title": "TrackHub Data",

      "description": "Contains data/metadata for a list of tracks defined in the TrackHub. Each track has a name attribute whose value is a property of the configuration object.",

      "items": { "$ref": "#/definitions/track_data" },

      "minItems": 1,
	  
      "uniqueItems": true
    },

    "configuration": {
      "type": "object",

      "title": "TruckHub Configuration",

      "description": "Contains display and configuration properties for the tracks speficied in the data object.",

      "patternProperties": {
        "^[a-zA-z][a-zA-Z0-9_]+$": { "$ref": "#/definitions/track_configuration" }
      },

      "additionalProperties": false
    }
  },

  "additionalProperties": false,

  "required": [ "name", "version", "data", "configuration" ],

  "definitions": {

    "track_data": {
      "title": "Track data/metadata definition.",

      "oneOf": [
        { "$ref": "#/definitions/generic_track_data" },
	{ "$ref": "#/definitions/epigenomics_track_data" },
	{ "$ref": "#/definitions/proteomics_track_data" }
      ]
      
    },

    "generic_track_data": {
      "type": "object",

      "title": "Generic track data/metadata",

      "description": "Track data/metadata properties common to all domain-specific tracks (e.g. epigenomics, proteomics).",

      "properties": {
        "name": { 
	  "type": "string",

	  "description": "The name of the track. It should corresponds to one entry in the configuration object."
	},

	"title": { "type": "string" },

	"description": { "type": "string" },

        "species": { "$ref": "#/definitions/species" },

	"assembly": { "$ref": "#/definitions/assembly" },

	"contacts": {
	  "type": "array",

	  "description": "A list of contacts related to the track.",

	  "items": { "$ref": "#/definitions/contact" },

	  "minItems": 1,
	  
	  "uniqueItems": true
	},

	"publications": {
	  "type": "array",

	  "description": "A list of publications related to the track.",

	  "items": { "$ref": "#/definitions/publication" },

	  "minItems": 1,
	  
	  "uniqueItems": true
	},
	
	"software": {
	  "type": "array",

	  "description": "A list of software used to analyse the data. The order should reflect the order in which the tools were used.",

	  "items": {
	    "type": "object",

	    "properties": {
      	      "type": { "type": "string" },
	      
	      "name": { "type": "string" },
	      
	      "version": { "type": "string" },
	      
	      "setting": {
	        "type": "array",

		"description": "A list of settings used for a particular software.",
		
		"items": { "type": "string" },

		"minItems": 1,

		"uniqueItems": true
	      }
	    }
	  },

          "minItems": 1,

	  "uniqueItems": true

	},

	"uri": {
	  "type": "array",

  	  "description": "A list of URIs pointing to the source data, e.g. PRIDE experiment or a PeptideAtlas build.",

	  "items": { "type": "string", "format": "uri" },

	  "minItems": 1,

	  "uniqueItems": true
	},
	
	"samples": {
	  "type": "array",

	  "description": "A list of samples analysed.",

	  "items": { "$ref": "#/definitions/sample" },

	  "minItems": 1,

	  "uniqueItems": true
	},

	"sample_processing": {
	  "type": "array",

	  "description": "A list of parameters describing sample processing steps. The order of the data processing items should reflect the order these processing steps were performed in. If multiple parameters are given for a step these MUST be separated by a '|'.",

	  "items": { "type": "string" },

	  "minItems": 1,

	  "uniqueItems": true
	},

        "study_variable": {
	  "type": "array",

	  "items": {
	    "type": "object",
	    "properties": { "description": { "type": "string" } }
	  },
	  "minItems": 1,
	  "uniqueItems": true
	},
     
        "custom": {
	  "type": "array",

	  "description": "Any additional parameters describing the analyses reported.",

	  "items": { "type": "string" },

	  "minItems": 1,

	  "uniqueItems": true
	}   
      },
      
      "required": [ "name", "species", "assembly" ]
    },

    "epigenomics_track_data": {
      "allOf": [
        { "$ref": "#/definitions/generic_track_data" },
	{ "properties": {
	    "molecule": { "type": "string" },
	    "disease": { "type": "string" },
	    "biomaterial_type": { "type": "string" },
	    "sample_ontology_uri": { "type": "string", "format": "uri" },
	    "disease_ontology_uri": { "type": "string", "format": "uri" },
	    "sample_id": { "type": "string" },

	    "line": { "type": "string" },
	    "lineage": { "type": "string" },
	    "differentiation_stage": { "type": "string" },
	    "medium": { "type": "string" },
	    "sex": { "type": "string", "enum": [ "Female", "Male" ] },

	    "donor_id": { "type": "string" },
	    "donor_age": { "type": "integer", "minimum": 0, "exclusiveMinimum": false },
	    "donor_health_status": { "type": "string" },
	    "donor_sex": { "type": "string", "enum": [ "Female", "Male" ] },
	    "donor_ethnicity": { "type": "string" },

	    "cell_type": { "type": "string" },
	    "culture_conditions": { "type": "string" },

	    "tissue_type": { "type": "string" },
	    "tissue_depot": { "type": "string" },

	    "experiment_type": { "type": "string" },
	    "library_strategy": { "type": "string" },
	    "experiment_id": { "type": "string" },
	    "reference_registry_id": { "type": "string" },
	    "analysis_group": { "type": "string" },
	    "alignment_software": { "type": "string" },
	    "alignment_software_version": { "type": "string" },
	    "analysis_software": { "type": "string" },
	    "analysis_software_version": { "type": "string" }
	  },

	  "additionalProperties": false
	}
      ]
    },

    "proteomics_track_data": {
      "allOf": [
        { "$ref": "#/definitions/generic_track_data" },
	{ "properties": {
	    "instruments": {
	      "type": "array",

	      "description": "A list of instruments used in the experiment",

	      "items": { "$ref": "#/definitions/instrument" },
	      "minItems": 1,
	      "uniqueItems": true
	    },

	    "search_engine_score": {
	      "type": "array",

	      "description": "The order of the search engine scores should reflect their importance for the identification and be used to determine the identification's rank.",

	      "items": { "type": "string" },
	      "minItems": 1
	    },
	    
	    "false_discovery_rate": {
	      "type": "string",
	      
	      "description": "The file's false discovery rate(s) reported at the PSM, peptide and/or protein level. False Localisation Rate (FLD) for the reporting of the modifications can also be reported here. Multiple parameters MUST be separated by '|'." 
	    },

	    "fixed_mod": {
	      "type": "array",

	      "description": "Parameters describing fixed modifications searched for.",

	      "items": { "type": "string" },
	      "minItems": 1,
	      "uniqueItems": true
	    },

	    "variable_mod": {
	      "type": "array",

	      "description": "Parameters describing variable modifications searched for.",

	      "items": { "type": "string" },
	      "minItems": 1,
	      "uniqueItems": true
	    },

	    "quantification_method": {
	      "type": "string",

	      "description": "The quantification method used in the experiment."
	    },

	    "protein_quantification_unit": {
	      "type": "string",

	      "description": "Defines what type of units is reported in the protein quantification fields."
	    },

	    "peptide_quantification_unit": {
	      "type": "string",

	      "description": "Defines what type of units is reported in the peptide quantification fields."
	    },

	    "ms_runs": {
	      "type": "array",

	      "items": { "$ref": "#/definitions/ms_run" },
	      "minItems": 1,
	      "uniqueItems": true
	    },

	    "assays": {
	      "type": "array",
	      
      	      "items": { "$ref": "#/definitions/assay" },
	      "minItems": 1,
	      "uniqueItems": true
	    }

	  },
	  
	  "additionalProperties": false
	}
      ]
    },

    "contact": {
      "type": "object",

      "properties": {
        "name": { "type": "string" },

	"affiliation": { "type": "string" },

	"email": { "type": "string", "format": "email" }
      }      
    },

    "publication": {
      "type": "object",

      "properties": {
        "pmid": { 
	  "type": "integer",

	  "description": "The PubMed ID",

	  "minimum": 1
	},

	"doi": { 
	  "type": "string",

	  "description": "The Digital Object Identifier"
	}
      }
    },

    "sample": {
      "type": "object",

      "properties": {
        "id": { "type": "string" },

	"description": { "type": "string" },

	"ontology_uri": { "type": "string", "format": "uri" },

	"species": {
	  "type": "array",

	  "description": "The respective species of the samples analysed. It's an array since we can have, e.g. different samples from different species (combinations) analysed as biological replicates.",

	  "items": { "$ref": "#/definitions/species" },

	  "minItems": 1,

	  "uniqueItems": true	  
	},

	"tissue": {
	  "type": "array",

	  "description": "The respective tissue(s) of the sample.",

	  "items": { "type": "string" },

	  "minItems": 1,

	  "uniqueItems": true
	},

	"cell_type": {
	  "type": "array",

	  "description": "The respective cell type(s) of the sample.",

	  "items": { "type": "string" },

	  "minItems": 1,

	  "uniqueItems": true
	},

	"disease": {
	  "type": "array",

	  "description": "The respective disease(s) of the sample.",

	  "items": { "type": "string" },

	  "minItems": 1,

	  "uniqueItems": true
	},

	"custom": {
	  "type": "array",

	  "description": "Parameters describing the sample's additional properties.",

	  "items": { "type": "string" },

	  "minItems": 1,

	  "uniqueItems": true
	}
      }
    },

    "species": {
      "type": "object",

      "title": "Species",
      "description": "Information about the organism the track relates to",

      "properties": {
        "taxid": { "type": "integer", "minimum": 0, "exclusiveMinimum": true },
	"scientific_name": { "type": "string" }
      },

      "required": [ "taxid" ]
    },

    "assembly": { 
      "type": "string",

      "title": "Assembly id",
      "description": "The NCBI assembly identifier (accession and version) the track relates to",

      "pattern": "^GCA_[0-9]+.[0-9]+$"
    },

    "tissue": {
      "type": "object",

      "properties": {
        "type": { "type": "string" },
	      
        "depot": { "type": "string" },

        "ontology_uri": { "type": "string", "format": "uri" }
      }
    },

    "cell_type": {
      "type": "object",

      "properties": {
        "name": { "type": "string" },

	"ontology_uri": { "type": "string", "format": "uri" }
      }
    },

    "disease": {
      "type": "object",

      "properties": {
        "name": { "type": "string" },

	"ontology_uri": { "type": "string", "format": "uri" }
      }
    },

    "instrument": {
      "type": "object",

      "description": "An instrument used in an experiment.",

      "properties": {
        "name": { "type": "string" },
	
	"source": { "type": "string" },

	"analyser": {
	  "type": "array",

	  "description": "The instrument analyser types used in the experiment",

	  "items": { "type": "string" },
	  "minItems": 1,
	  "uniqueItems": true
	},

	"detector": { "type": "string" }
      },

      "additionalProperties": false
    },

    "ms_run": {
      "type": "object",

      "properties": {
        "format": {
	  "type": "string",

	  "description": "A parameter specifying the data format of the external MS data file. If format is present, id_format should also be present."
	},

	"id_format": {
	  "type": "string",
	  
	  "description": "A parameter specifying the id format of the external MS data file. If id_format is present, format should also be present."
	},

	"location": {
	  "type": "string",

	  "description": "Location of the external data file. If the actual location of the MS data run is unknown, a 'null' MUST be used as a placed holder value.",

	  "oneOf": [
	    { "type": "string", "format": "uri" },
            { "type": "string", "enum": [ "null" ] }
          ]
	},
	
	"fragmentation_method": {
	  "type": "string",

	  "description": "Parameters describing all the types of fragmentation used in a given ms run. Multiple parameters MUST be separated by '|'."
	}
      },

      "additionalProperties": false
    },

    "assay": {
      "type": "object",

      "properties": {
        "quantification_reagent": { 
	  "type": "string",

	  "description": "The reagent used to label the sample in the assay."
	},

	"quantification_mod": {
	  "type": "array",

	  "description": "A list of modifications associated with a quantification reagent.",

	  "items": { "type": "string" },
	  "minItems": 1,
	  "uniqueItems": true
	}
      },

      "additionalProperties": false
    },

    "track_configuration": {
      "title": "Track display and configuration properties.",

      "oneOf": [
	 { "$ref": "#/definitions/bigBed_track" },
	 { "$ref": "#/definitions/bigWig_track" },
	 { "$ref": "#/definitions/bam_track" },
	 { "$ref": "#/definitions/vcfTabix_track" },
	 { "$ref": "#/definitions/super_track" },
	 { "$ref": "#/definitions/composite_track" },
	 { "$ref": "#/definitions/aggregate_track" }
      ]

    },

    "track": {
      "type": "object",

      "description": "Contains display and configuration properties common to all track types.",

      "properties": {

	"shortLabel": { "$ref": "#/definitions/shortLabel" },

	"longLabel": { "$ref": "#/definitions/longLabel" },

	"visibility": { "$ref": "#/definitions/visibility" },

	"boxedCfg": { 
	  "type": "boolean",

	  "description": "Configuration controls can be placed inside a box on the configuration page. This setting is decorative only, but can make a busy page look more cohesive. Not all track types currently support this feature, but the most common types do, including wig, bigWig, bed, and bigBed. DEFAULT: off."
	},

	"color": { 
	  "$ref": "#/definitions/color",

	  "description": "Many track types allow the color of the data displayed in the image to be specified with this setting. The setting accepts red, green and blue values, each in the range of 0-255 and delimited by commas. Though this setting is widely supported, some track types in certain display modes ignore it, such as the EST tracks in dense mode."
	},
	
	"altColor": { 
	  "$ref": "#/definitions/color",

	  "description": "Many track types allow setting a color range that varies from color to altColor. For instance the CpG Island tracks use the altColor setting to display the weaker islands, while the stronger ones are rendered in color. If altColor is not specified, the system will use a color halfway between that specified in the color tag and white instead."
	},

	"chromosomes": {
	  "type": "array",

	  "description": "Some datasets do not contain data for all chromosomes of a genome. When this is true, use this setting to specify the chromosomes that are covered. The system displays a message that no data is available when the user browses chromosomes not included in this list.",

	  "items": { "type": "string" },

	  "minItems": 1,
	  
	  "uniqueItems": true
	},

	"dataVersion": {
	  "type": "string",

	  "description": "Many tracks undergo multiple revisions over time. In some cases, the older versions should be retained, but even if they are not, it can be useful to declare the current version of the track. Use this setting to display a version statement on the track configuration page and item details page of a track."
	},

	"directUrl": {
	  "type": "string",

	  "description": "Link to a details page giving information about that item.",

	  "format": "uri"
	},

	"iframeUrl": { 
	  "type": "string",

	  "description": "This setting allows integrating an external html page into the default details page, as an iframe."
	},

	"iframeOptions": {
	  "type": "string",

	  "description": "When iframeUrl is used, this statement specifies a string that is inserted literally into the HTML <iframe> tag. It can include options needed for iframe formatting, like width, height, scrolling, etc. If the statement is not present, the default is width='100%' height='1024'."
	},

	"otherDb": {
	  "type": "string",

	  "description": "Track types that show pairwise alignments often need to declare the other species/assembly included in the alignment."
	},

	"pennantIcon": {
	  "type": "object",

	  "description": "Certain tracks can be visually flagged in the Browser by use of an icon and a link to a description of the icon's meaning. The icon is displayed next to the track's short label in the track groups section below the Browser image, and on the track's description and configuration pages. This setting has three parts: 1. icon: currently must refer to an icon in the Browser's images directory in the Browser source tree; 2. a relative or full html path to a description document explaining the icon's meaning. This page displays when the user clicks on the icon; 3. tip: a quoted string tip that will be seen when the user's mouse pointer hovers over the icon.",

	  "properties": {
	    "icon": { "type": "string", "format": "uri" },
	    "html": { "type": "string", "format": "uri" },
	    "tip": { "type": "string" }
	  }
	},

	"priority": {
	  "type": "number",

	  "description": "The priority is used to define the order of a track within its track group or data hub, as well as its default order within the Browser image. The order within the image can be dynamically changed by the user and will always depend upon which other tracks are currently visible. Typically the priority is set only for tracks that are on by default in order to move them ahead of other tracks. Prioritized tracks within a group or data hub are displayed in ascending priority order, followed by unprioritized tracks sorted alphabetically by short label. Tracks of the same priority within a group or hub are sorted by short label. Priority is a floating point number. Default: 0."
	},

	"url": {
	  "type": "string",

	  "description": "Many tracks allow an external link when an individual track data item is examined. Use this setting to put a link to an external URL on the details page. The default prompt the user will see for this url is \"outside link:\". Use urlLabel to provide a more informative prompt.",

	  "format": "uri"
	},

	"urlLabel": { "type": "string" },

	"urls": {
	  "$ref": "#/definitions/fields_urls",

	  "description": "This is similar to the url tag, but allows urls on fields that are not the \"name\" field. Use this statement if you need multiple linkouts on the details page or if your linkout is not based on the name field."
	}
      },

      "required": [ "shortLabel", "longLabel", "visibility" ]
    },

   "bigBed_track": {
      "title": "bigBed track configuration properties",
      "description": "bigBed track configuration properties. Inherites the properties common to all track types.",
      
      "allOf": [
        { "$ref": "#/definitions/track" },

	{ "properties": {
	    "type": { 
	      "type": "string", 

	      "enum": [ "bed", "bigBed" ] 
	    }, 

	    "standard_fields": {
	      "type": "number",

	      "minimum": 3,
	      "exclusiveMinimum": false,

	      "maximum": 12,
	      "exclusiveMaximum": false
	    },

	    "non_standard_fields": { "type": "boolean" },

	    "bigDataUrl": { "$ref": "#/definitions/bigDataUrl" },

	    "colorByStrand": {
	      "type": "array",

	      "description": "To color items differently by the strand they align to. The first color will be used for plus strand alignments and the second for the minus strand. This setting is incompatible with spectrum and all items on the same strand will have the same color, regardless of the item's score.",

	      "items": [
	        { "$ref": "#/definitions/color" },
		{ "$ref": "#/definitions/color" }
	      ]
	    },

	    "denseCoverage": {
	      "type": "number",

	      "description": "Type bigBed tracks in dense mode do a density plot based on maximum coverage seen at each pixel. The maxVal corresponds to the count at which the plot reaches maximum darkness. If maxVal is 0 then this will be calculated from the data itself.",

	      "minimum": 0
	    },

	    "exonArrows": {
	      "type": "boolean",

	      "description": "On tracks that show exons or blocks within features, exon arrows allow the user to jump to the next exon or block outside the image. Exon arrows are typically shown by default in these types of tracks, with the exception of tracks in the Regulation group. The arrows can be explicitly shown or hidden using this setting."
	    },

	    "scoreFilter": { "$ref": "#/definitions/scoreFilter" },

	    "itemRgb": {
	      "type": "boolean",

	      "description": "In bed formats supporting at least 9 standard bed fields, this setting can be used to activate item coloring using the value in the ninth field, itemRgb. The value of the item field must be an R,G,B triplet. When loaded into a table, this field appears as an integer with the RGB values in specific bits of the integer."
	    },

	    "maxItems": { 
	      "type": "integer",

	      "description": "Maximum number of items to display individually in full mode. When the maximum is exceeded, the excess items are drawn on top of one another on the last line. In packed mode this refers to the number of lines rather than number of items. Default: 250. For type bigBed tracks, this setting can never be larger than than 100,000."
	    },

	    "maxWindowToDraw": { 
	      "type": "integer",

	      "description": "When too many individual bed items are shown in the Browser image (such as might occur when a large region of a chromosome is viewed), the information is often better visualized as a summary in dense mode. Depending on the current visibility of the bed track and which other tracks are being shown concurrently, the Browser may automatically reduce the display to pack or dense mode. This setting allows you to force the data summarization at whatever display limit you consider reasonable. Unlike the maxItems setting, which controls the display of vertical space, this setting dictates the number of bases to be displayed horizontally in a window before the track is forced into dense mode. There is no default for this setting, but the maxItems setting will ultimately prevent too many items from being displayed."
	    },

	    "minGrayLevel": {
	      "type": "integer",

	      "description": "When a bed track contains the standard field score, and when that score is used to present items in gray or color scale (see spectrum), this setting specifies the lightest shade to be used. This prevents the lowest scores from being displayed in too light of a color to easily view. Set the value in the range 1 - 9, lightest to darkest.",

	      "minimum": 1,

	      "maximum": 9
	    },

	    "noScoreFilter": {
	      "type": "boolean",

	      "description": "By default, bed tracks with 5 or more standard bed fields that contain either a '.' or a '+' in the type setting will be filterable on score; that is, they will have an assumed setting of \"scoreFilter 0\". To turn this old-style default off, include the \"noScoreFilter\" setting."
	    },

	    "spectrum": {
	      "type": "boolean",

	      "description": "If your track is a bed 5 or greater, then the standard bed score field exists. This score, which is expected to vary from 0-1000, can be used to control the shading of bed items drawn in the Browser image. To activate this feature, set spectrum on. Lower scores will be shaded in light gray by default, while higher scores will trend towards black. This can be modified in a number of ways: 1. color can be used to replace gray scale with a color scale; 2. altColor with color can vary items from color to altColor; 3. minGrayLevel can be used to set the level of the lightest shade; 4. scoreMin and scoreMax can be used to define the lower and upper limits of the range that will receive graded shading"
	    },
	    
	    "scoreMin": { "type": "integer" },
	    
	    "scoreMax": { "type": "integer" },

	    "thickDrawItem": {
	      "type": "boolean",

	      "description": "In bed tracks that have 8 or more standard bed fields, portions of items in tracks such as gene models can be drawn thicker to differentiate exon regions from introns. When data is displayed at different scales, the items and the thick portions of the items should scale proportionally. However, it may be more important to see the existence of the thick regions than it is to attempt to maintain the proportion. By setting thickDrawItem on, the thick display regions of items are always drawn at a minimum of 3 pixels, even when zoomed out greatly."
	    },

	    "searchIndex": {
	      "type": "string",

	      "description": "Specifies the list of field names on which a index has been made. When a user enters a string in the position search box of the browser, this index will be searched to find that name, and if the string is in the index, the user will either be navigated to that position in the browser, or if there are more than one matches of that string, will be give a list of the positions to choose from."
	    },

	    "searchTrix": {
	      "type": "string",
	      
	      "description": "Specifies the URL to a TRIX file that maps free text to a set of indices that are assumed to have indicies in the associated bigBed file.",

	      "format": "uri"
	    },

	    "bedNameLabel": {
	      "type": "string",

	      "description": "When a user clicks on a bed track item in the Browser image, the item detail page is shown. This setting specifies an alternate label for the item name on that page. Without this setting, the label will be 'Item:'."
	    },

	    "exonArrowsDense": {
	      "type": "boolean",
	      
	      "description": "On tracks that show exons or blocks within items, exon arrows allow the user to jump to the next exon/block outside the image. Use this setting to display exon arrows even when the track is in dense mode."
	    },

	    "itemImagePath": { "$ref": "#/definitions/image_path" },

	    "itemBigImagePath": { "$ref": "#/definitions/image_path" },

	    "nextExonText": {
	      "type": "string",

	      "definition": "For tracks that offer multiple block items such as gene models, the next/previous exon arrows are usually displayed by default in the Browser. The functionality of these tiny arrows is described by mouse-over \"tool tips\" that default to \"Next Exon\" and \"Prev Exon\". If the blocks do not represent exons, you can adjust the tool tip text to the appropriate information with these two settings."
	    },

	    "prevExonText": { "type": "string" },

	    "showTopScorers": { "type": "integer" }
	  },

	  "required": [ "type" ]
	}
      ]  
    },

    "bigWig_track": {
      "title": "bigWig track configuration properties",
      "description": "bigWig track configuration properties. Inherites the properties common to all track types.",

      "allOf": [
        { "$ref": "#/definitions/track" },

	{ "properties": {
	    "type": { 
	      "type": "string", 

	      "enum": [ "bigWig" ] 
	    }, 

	    "range": { "$ref": "#/definitions/range" },

	    "alwaysZero": {
	      "type": "boolean",

	      "description": "When autoScale is set to \"on\" in the signal track, additionally setting alwaysZero to \"on\" will ensure that the y=0 value will be in view at all times. Default: off."
	    },

	    "autoScale": {
	      "type": "boolean",

	      "description": "The graph of the data displayed in the Browser image is usually scaled on the y axis in absolute coordinates. However, you can display the data in autoScale which will ensure that the high score in the current viewing window will peak at the top of the graph. Like most graph settings, this is configurable by the user. Setting it to \"on\" in trackDb will default the track to autoScale. Default: off. NOTE: this option should be avoided if it will lead to display regions in which a low signal erroneously appears as significant because there is no high signal in the view window."
	    },

	    "bigDataUrl": { "$ref": "#/definitions/bigDataUrl" },

	    "graphTypeDefault": {
	      "type": "string",

	      "description": "The signal can be graphed as either 'points' displayed at the signal value, or the default space-filling 'bars'.",

	      "enum": [ "bars", "points" ]
	    },

	    "maxHeightPixels": {
	      "type": "object",

	      "description": "The amount of vertical viewing space for your signal track should be declared, though it is configurable by the user. Typically it is set to no more than 100 pixels and no less than 8, with a default of 16 or 32 pixels.",

	      "properties": {
	        "max": { "type": "number" },
		"default": { "type": "number" },
		"min": { "type": "number" }
	      },

	      "required": [ "max", "default", "min" ]
	    },

	    "maxWindowToQuery": {
	      "type": "integer",

	      "description": "When signal data is clicked in the Browser image, the details of the signal in the current viewing window are displayed. For bigWigs that reference remote data, the query can be a very expensive operation if the current window is large. To avoid overburdening the Browser, the size of the window to query should be limited. The value of this setting is the maximum window size in bases that should be queried to give the detailed signal numbers."
	    },

	    "negateValues": {
	      "type": "boolean",

	      "description": "Negate the values in the wiggle, meaning that positive values become negative and vice-versa. This is useful for wiggles representing transcription or other activities on the Crick strand. Be aware that wiggles with negative values are drawn in altColor not color as positive values are."
	    },

	    "smoothingWindow": {
	      "description": "Often signal information is chunky, because a single value is given for a number of bases. The graph can smooth the chunky data, presenting a display more reflective of the actual biology it is meant to illustrate. The numerical value of this setting determines how much surrounding data to use for smoothing: the larger the number, the less abrupt the curves will be. The setting is user-configurable. Default: off.",

	      "oneOf": [
	        { "type": "boolean" },
		{ 
		  "type": "integer",
		  "minimum": 1,
		  "maximum": 16
		}
	      ]
	    },

	    "transformFunc": {
	      "type": "string",
	      
	      "description": "The track's signal can be presented in log scale with this user-configurable setting. Default: NONE.",

	      "enum": [ "NONE", "LOG" ]
	    },

	    "viewLimits": { "$ref": "#/definitions/range" },

	    "viewLimitsMax": { "$ref": "#/definitions/range" },

	    "windowingFunction": {
	      "type": "string",

	      "description": "Depending upon how large of a genomic region is displayed in the Browser image, it may be necessary to summarize the actual signal. This user-configurable setting controls how the Browser collapses the signal from (for example) 100 or 100 thousand bases down to a single pixel. By default the single pixel represents the mean of the data, though the maximum or minimum can alternatively be displayed. A more informative option is often mean+whiskers. This setting displays the mean, max and one standard deviation above mean, differentiated by shading. The mean is displayed as the darkest shade, one stdDev above mean as slightly lighter, and the max as the lightest shade. This subtle shading can quickly indicate if the condensed data is hiding important information that can be adequately evaluated only by zooming in.",

	      "enum": [ "mean", "mean+whiskers", "maximum", "minimum" ]
	    },

	    "yLineOnOff": {
	      "type": "boolean",

	      "description": "It can be useful to draw a line across the track's signal graph at some fixed y coordinate. Do this by setting yLineOnOff to \"on\" and specifying the y coordinate with yLineMark. These two settings are configurable by the user. Defaults: off and 0.0."
	    },
	    
	    "gridDefault": { "type": "boolean" },

	    "yLineMark": { "type": "number" }	    
	  },

	  "required": [ "type" ]
	}
      ]    
    },

    "bam_track": {
      "title": "BAM track configuration properties",
      "description": "BAM track configuration properties. Inherites the properties common to all track types.",

      "allOf": [
        { "$ref": "#/definitions/track" },

	{ "properties": {
	    "type": { 
	      "type": "string", 

	      "enum": [ "bam" ] 
	    }, 

	    "bigDataUrl": { "$ref": "#/definitions/bigDataUrl" },

	    "bamColorMode": {
	      "type": "string",

	      "description": "There are numerous ways to color bam tracks to highlight certain aspects of the data. All of these are user-configurable. Possible settings: 1. strand: (Default) When colored by strand, mismatched bases are highlighted in bright red, alignments on the reverse strand are colored dark red, and alignments on the forward strand are colored dark blue; 2. gray: When colored in grayscale, items are shaded according to the method specified by bamGrayMode: alignment quality, base qualities, or unpaired ends; 3. tag: Colors are specified in \"user-defined tags\". SAM/BAM may include user-defined tags, the names of which begin with X, Y or Z and include one other letter or number. The user-defined tag named here specifies red, green and blue (RGB) intensities as a zero-terminated string (tag type Z) containing comma-separated triples of numbers from 0-255. For example, if a SAM/BAM record includes the tag YC:Z:255,0,0, then the item is colored red; YC:Z:0,0,255 makes the item blue. By default, the tag is \"YC\" unless changed using the bamColorTag setting; 4. off: No additional coloring.",

	      "enum": [ "strand", "gray", "tag", "off" ]
	    },

	    "bamGrayMode": {
	      "type": "string",

	      "description": "When bamColorMode is set to \"gray\", you can highlight one of the following: 1. aliQual: (Default) The \"alignment qualities\" of the items are shaded on a scale of 0 (lightest) to 99 (darkest). Use aliQualRange to specify a default range; 2. baseQual: \"Base qualities\" are shaded on a scale of 0 (lightest) to 40 (darkest). Use baseQualRange to specify a default range; 3. unpaired: When \"unpaired ends\" is selected, an item that was paired in sequencing but whose mate was not mapped is colored gray, while singletons and properly paired items are colored black. Refer to the SAM format details for a discussion of these values.",

	      "enum": [ "aliQual", "baseQual", "unpaired" ]
	    },

	    "aliQualRange": { "$ref": "#/definitions/range" },

	    "baseQualRange": { "$ref": "#/definitions/range" },
	    		     
	    "bamColorTag": {
	      "type": "string",

	      "description": "You can also use RGB data associated with individual tags within the bam file itself. Refer to the SAM documentation to understand how the RGB values are included. When the bamColorMode is set to 'tag', the standard 'YC' tag is used as the default. The default may be overridden with this setting."
	    },

	    "noColorTag": { 
	      "type": "boolean",

	      "description": "The bam coloring options are all user-configurable within the browser. If your bam dataset contains no color tags, this setting should be included to block the Browser from offering the option to color tags by an embedded RGB value."
	    },

	    "bamSkipPrintQualScore": {
	      "type": "boolean",

	      "description": "Any bam tag can be displayed on the details page by clicking on it in the Browser image. The details include quality scores by default. If these scores are not relevant for this particular bam, they may be excluded from the details page with this setting."
	    },

	    "indelDoubleInsert": {
	      "type": "boolean",

	      "description": "Insertion and deletion differences between tag sequences and the reference genome can be highlighted with the use of these settings. These options may be set by the user. indelDoubleInsert: Use to highlight alignment gaps in both the target (reference) and query (tag) sequence with double (=) lines. indelQueryInsert: Use to highlight an insert in the query sequence only by drawing an orange (|) or purple (|) vertical line. Orange lines show unalignable regions in the middle of a sequence, and purple highlights regions at the end of the query sequence. indelPolyA: Use to highlight an apparently valid poly-a tail by drawing a vertical green line (|)."
	    },

	    "indelQueryInsert": { "type": "boolean" },

	    "indelPolyA": { "type": "boolean" },

	    "minAliQual": {
	      "type": "number",

	      "description": "When the Browser image is zoomed in to the level where individual tags are visible, the tags in a bam file can be filtered to show only those with a minimum alignment quality score. This is a user-configurable setting. Default: 0."
	    },

	    "pairEndsByName": {
	      "type": "boolean",

	      "description": "Some high-throughput sequencing technologies result in \"paired end\" tags, which are two individual bam records joined by their name. If this is the case with your dataset, include this setting."
	    },

	    "pairSearchRange": {
	      "type": "number",

	      "description": "Searching to join pairs of tags by name will be limited to a maximum distance (default: 20,000 bases). Use a larger range to increase the likelihood that both reads in a pair will be found even when only one read is in the viewed region. Use a smaller range to speed image rendering."
	    },

	    "showNames": {
	      "type": "boolean",

	      "description": "When the Browser image is zoomed in to the level where individual tags are viewable, the query name for each tag is shown by default. Use this setting to hide this name."
	    }
	    
	  },

	  "required": [ "type", "bigDataUrl" ]
	}
      ]      
    },

    "vcfTabix_track": {
      "title": "vcfTabix track configuration properties",
      "description": "vcfTabix track configuration properties. Inherites the properties common to all track types.",

      "allOf": [
        { "$ref": "#/definitions/track" },

	{ "properties": {
	    "type": {
	      "type": "string",

	      "enum": [ "vcfTabix" ]
	    },

	    "bigDataUrl": { "$ref": "#/definitions/bigDataUrl" }

	  },

	  "required": [ "type" ]
	}
      ]      
    },

    "super_track": {
      "title": "Represents heterogeneous tracks as a single group",
      "description": "This hierarchical may be thought of as a folder that holds other tracks. The Browser currently supports only one level of supertrack folders. Generally the subtracks of a supertrack are of differing types. If all the children are of the same type, it is often better to use the 'compositeTrack' grouping described below. If all of the children are wig or bigWig tracks, it may be of interest to use a signal overlay 'container multiWig' grouping. Signal overlay tracks display the signal data from several subtracks as colored transparencies, making it possible to see the data of several tracks together in a condensed view.",

      "allOf": [
        { "$ref": "#/definitions/track" },

	{ "properties": {
	    "container": {
	      "type": "string",

	      "enum": [ "superTrack" ]
	    },

	    "show": {
	      "type": "boolean",

	      "description": "To set a supertrack to display as default."
	    },

	    "subtracks": {
	      "type": "array",

	      "items": { 
	        "oneOf": [
	          { "$ref": "#/definitions/bigBed_track" },
	          { "$ref": "#/definitions/bigWig_track" },
	          { "$ref": "#/definitions/bam_track" },
	          { "$ref": "#/definitions/vcfTabix_track" },
	          { "$ref": "#/definitions/composite_track" },
	          { "$ref": "#/definitions/aggregate_track" }
	        ]
	      },

	      "minItems": 1,

	      "uniqueItems": true
	    },

	    "group": { "type": "string" }
	  },
	  
	  "required": [ "container", "subtracks" ],
	  "additionalProperties": false
	}
      ]
    },

    "composite_track": {
      "title": "Composite track display and configuration properties",
      "description": "Composite tracks are another level of hierarchy and are meant to group very similar tracks (called 'subtracks') together such that they can all share the same configuration settings. In its simplest form a composite holds tracks all of the same type (such as bigBed). Initially, all track within the set are configured identically. Usually only some of the subtracks are visible by default, and these will have the same display mode (e.g., dense) and optional settings (e.g., viewLimits). While default settings cover the entire composite of related tracks, in most cases individual subtracks can be configured by the user independently of the composite settings. However, once individual subtrack settings are made, they can be overridden by new choices made at the composite level.",

      "allOf": [
        { 
	  "oneOf": [
            { "$ref": "#/definitions/bigBed_track" },
            { "$ref": "#/definitions/bigWig_track" },
            { "$ref": "#/definitions/bam_track" },
            { "$ref": "#/definitions/vcfTabix_track" }
          ]
	},

	{ "properties": {
	    "container": {
	      "type": "string",

	      "enum": [ "composite" ]
	    },

	    "allButtonPair": {
	      "type": "boolean",

	      "description": "When a simple composite track presents a short list of subtracks, it can be convenient for the user to have an easy way to select or deselect all of them. Include this setting to display an 'All (plus and minus button pair)' for the user's convenience. If the list contains more than 10 subtracks, other methods may be more useful for organizing and selecting subtracks."
	    },
	    
	    "centerLabelsDense": {
	      "type": "boolean",

	      "description": "By default, only the composite track's single center label is shown when the subtracks are displayed together in the Browser dense mode. If centerLabelsDense is set, the Browser will display a center label for each subtrack."
	    },

	    "dragAndDrop": {
	      "type": "boolean",

	      "description": "The subtrack list in the configuration page can be rearranged by setting a sortOrder or by allowing the user to drag and drop the subtracks to a new order if enabled with this setting. The changed order will also be seen in the track image. However, the order of tracks can always be rearranged through drag and drop, directly in the image. Reordering subtracks in the image will not be reflected in the configuration page. Note: This setting will not work correctly if 'container multiWig' is specified."
	    },

	    "subgroups": {
	      "type": "array",

	      "description": "Up to 9 subgroup types can be defined for a composite. However, to minimize the complexity, it is strongly recommended that only two subgroups be defined for a given composite track. These will be presented in a simple X/Y matrix that is easy for the user to understand and navigate. It is possible to define more subgroups in additional 'abc' dimensions that will be presented to the user as drop-down multi-select dialogs, but use of these should be avoided or minimized.",

	      "items": { "$ref": "#/definitions/subgroup" },

	      "minItems": 1,
	      "maxItems": 9,
	      "uniqueItems": true
	    },

	    "subtracks": {
	      "type": "object",

	      "patternProperties": {
                "^[a-zA-z][a-zA-Z0-9_]+$": { "$ref": "#/definitions/composite_subtrack" }
      	      }
	    },

	    "views": {
	      "type": "object",

	      "patternProperties": {
                "^[a-zA-z][a-zA-Z0-9_]+$": { "$ref": "#/definitions/composite_view" }
      	      }
	    }

	  },

	  "required": [ "container" ],
	  "additionalProperties": false
	}
      ]
    },

    "subgroup_membership": {
      "type": "object",

      "title": "Allows to define membership of a subtrack of a composite to a subgroup",
      "definition": "Declares the tag/title group membership pair to be able to assign a subtrack to a subgroup of a composite track.",

      "properties": {
        "tag": {
	  "type": "string",
	  "description": "A group's member tag"
	},
	"title": {
	  "type": "string",
	  "description": "A group's member title"
	}
      }
    },

    "subgroup": {
      "type": "object",

      "title": "Defines subgroup of a composite track",
      "description": "The subgroup can be used for selecting sets of subtracks for display based on certain characteristics of the data. For instance, if 'cell' and 'antibody' are defined as subgroups within a composite track, the user will be able to select subtracks based on specific cell types and antibodies to display in the Browser.",

      "properties": {
        "tag": {
	  "type": "string",

	  "title": "Composite subgroup tag",
	  "description": "Used to select and sort subtracks based upon their membership. Tag names must be alphanumeric, begin with a letter, and be formed such that the desired sort order of the member subtracks will result.",
	  "format": "^[a-zA-Z]"
	},

	"title": {
	  "type": "string",

	  "title": "Composite subgroup title",
	  "description": "Label of the subgroup as it appears on the selection matrix that is displayed to the user, e.g. 'Antibody;. Spaces within titles must be replaced by '_'. A limited amount of HTML is allowed in titles, such as the insertion of Greek letters using an HTML code. Any use of HTML should be tested to ensure that it displays correctly."
	},

	"membership": {
	  "type": "array",

	  "title": "List of tag/title group membership pairs",

	  "items": { "$ref": "#/definitions/subgroup_membership" },

	  "minItems": 1,
	  "uniqueItems": true
	},

	"dimension": {
	  "type": "integer",

	  "title": "Declares the dimension defined by a group.",

	  "minimum": 1,
	  "exclusiveMinimum": false
	},

	"sortOrder": {
	  "type": "string",

	  "description": "When declaring subgroups, it is often useful to sort the subtrack list by those subgroups. By including a sortOrder setting, long sets of subtracks are more easily organized and navigated by the user. If there are only a few subtracks in the composite, sorting may be of little value and dragAndDrop may be a better option. Currently only subgroups can be defined in the sortOrder, but it is anticipated that this will expand to include short and long labels as well. Sorting will occur on the tag values defined in the subgroup. By sorting on tags, non-alphanumeric orders can be defined.",

	  "enum": [ "asc", "desc" ]
	}
      }
    },

    "composite_subtrack": {
      "allOf": [
        {
	  "oneOf": [
            { "$ref": "#/definitions/bigBed_track" },
            { "$ref": "#/definitions/bigWig_track" },
            { "$ref": "#/definitions/bam_track" },
            { "$ref": "#/definitions/vcfTabix_track" }
          ]
	},

	{ "properties": {
	    "visible": { 
	      "description": "Whether the subtrack should be visible (checked, selected) by default.",
	      "type": "boolean"
	    },

	    "subgroups": {
	      "type": "array",

	      "items": {
	        "type": "string",

		"description": "Points to a subgroup_membership item in a subgroup of a composite track. This defines the membership of the subtrack to a subgroup.",

		"format": "uri"
	      }
	    }
	  }
	}
      ]
    },

    "composite_view": {
      "allOf": [
        {
	  "oneOf": [
            { "$ref": "#/definitions/bigBed_track" },
            { "$ref": "#/definitions/bigWig_track" },
            { "$ref": "#/definitions/bam_track" },
            { "$ref": "#/definitions/vcfTabix_track" }
          ]
	},

	{ "properties": {
	    "viewUi": { 
	      "description": "If subtracks within a view are configurable, then the view will have the configuration controls for it in a box beneath the view's visibility drop down. That box filled with configuration controls is hidden by default so that the UI is not too cluttered. The user must first open the box before its contents are seen. If there is only one view with configuration settings, or if the view is the most important one, the box can be open by default. Use this setting in the view stanza of settings to default the configuration box as open.",
	      "type": "boolean"
	    },
	    
	    "subtracks": {
	      "type": "object",

	      "patternProperties": {
                "^[a-zA-z][a-zA-Z0-9_]+$": { "$ref": "#/definitions/composite_subtrack" }
      	      }
	    }
	    
	  }
	}
      ]      
    },

    "aggregate_track": {

      "title": "multiWig track display and configuration properties",
      "description": "In some instances, data from multiple tracks is so closely related that it makes sense to view it as a single track. The premiere example of this is the signal overlay track (i.e. 'multiWig'). Signal overlay tracks display the signal data from several subtracks combined in several different ways, making it possible to see the data of several tracks together in a condensed view. The default overlay method for multiWigs is as colored transparencies, in which all the graphs are drawn on top of one other in such a way that overlapping regions are a different color. Another choice is solid overlay, where all the graphs are still drawn overlapping each other, but without transparency. A third choice is stacked where the values of the subtracks are stacked on top of one another with no overlap such that the total height of the wiggle is the sum of all the values in the subtracks. The value of the overlay track surpasses simply condensing the image. Occasionally this is the most effective way to identify hidden relationships in the underlying data. The overlay track should not be overused, however. Attempts to overlay too many subtracks can hide important information as regions with many layered signals become too dark to interpret. More than eight subtracks in a single overlay may prove less than ideal. As with composites, it is important for the multiWig tracks to have the same data dimensions, i.e. a signal height of 100 should be interpretable in the same way for the whole set of tracks. While this is true for a composite or view, it is especially important for overlay tracks. You cannot reasonably overlay a signal from 0-1 with another signal from 0-1000. Signal overlay tracks are declared much like simple composites. Like simple composites, all subtrack types should be identical and the container itself should be declared as the same type (e.g. 'bigWig'). Also like a composite, the container parent should have common settings for all children. Unlike composites, containers can have neither subgroups nor views. Additionally, all subtracks within a container are configured as one; there is no independent configuration of individual subtracks. Even when the user sets the overlay method to none and the subtracks are viewed as separate signals, they are still configured as a set.",

      "allOf": [
        { "$ref": "#/definitions/bigWig_track" },

	{ "properties": {
	    "container": {
	      "type": "string",

	      "enum": [ "multiWig" ]
	    },

	    "subtracks": {
	      "type": "array",

	      "items": { "$ref": "#/definitions/bigWig_track" },

	      "minItems": 1,

	      "uniqueItems": true
	    },

	    "aggregate": {
	      "type": "string",

	      "definition": "It is important to declare an aggregation method; otherwise, this set of tracks displays as a composite would, with additional restrictions. Of the four options, the preferred setting is transparentOverlay. The setting stacked will draw the graphs in stacked mode. The setting solidOverlay should not be used if there are more than a couple of tracks, and none should never be the default. The aggregation method is a configurable option, however, so the user may wish to temporarily set it to none in order to see subtleties hidden in overlay mode.",

	      "enum": [ "transparentOverlay", "stacked", "solidOverlay", "none" ]
	    },

	    "showSubtrackColorOnUi": {
	      "type": "boolean",

	      "description": "Subtracks in an overlay have individual colors. Use this setting to show the color associated with each on the track configuration page."
	    }
	  },
	  
	  "required": [ "container", "aggregate", "subtracks" ],
	  "additionalProperties": false
	}
      ]
    },
    
    "shortLabel": {
      "type": "string",

      "definition": "Specifies the track's \"short label\", which is used in a number of places in the Browser to identify the track.",

      "maxLength": 17
    },

    "longLabel": {
      "type": "string",

      "definition": "Specifies the track's \"long label\", which is also used in numerous places in the Browser to identify a track. This label should be descriptive enough to allow users to uniquely identify the track within the Browser.",

      "maxLength": 76
    },

    "bigDataUrl": {
      "type": "string",

      "description": "The location of a remote data file containing the bulk of the data for the track. The setting is either the full URL (including http: or another protocol) or it is relative to the directory in which the trackDb file containing this setting is located. The file must be in one of the supported remote data file formats: bam, bigBed, bigWig or vcfTabix. Note that bam and vcfTabix types require a separate index file that must have the same name as the data file plus a standard suffix (\".bai\" and \".tbi\" respectively).",

      "format": "uri"
    },   

    "visibility": {
      "enum": [ "hide", "dense", "squish", "pack", "full" ],

      "description": "Visibility (i.e. \"display mode\") specifies which of 5 modes (including 'hide') should be used to display the track within the Browser image. This setting is almost always dynamically customizable by each user. The exact configuration of the display for each mode depends upon the track's type, and some modes may not be supported for certain track types. Valid settigs: 1. hide: DEFAULT. The track is not displayed in the Browser image unless the user changes the display setting; 2. dense: The track is displayed as a single line or ribbon. In many cases multiple items are summarized or drawn on top of one another, and the long labels are not displayed; 3. squish: Each item is drawn individually, but at half height and without a label. (Not supported for all types.); 4. pack: Items are displayed individually at full height, but in a much more compact vertical space than in full mode. (Not supported for all types.); 5. full: Each item is displayed as a separate line in the Browser image. Graphed signals may be displayed in varying heights."
    },

    "color_code": {
      "type": "integer",

      "minimum": 0,
      "exclusiveMinimum": false,

      "maximum": 255,
      "exclusiveMaximum": false
    },

    "color": {
      "type": "object",

      "description": "Specifies a color as red, green, blue values",

      "properties": {
        "red": { "$ref": "#/definitions/color_code" },
	"green": { "$ref": "#/definitions/color_code" },
	"blue": { "$ref": "#/definitions/color_code" }
      }
    },

    "fields_urls": {
      "type": "array",

      "items": {
        "type": "object",

	"properties": {
	  "field": { "type": "string" },
	  "url": { "type": "string", "format": "uri" }
	}
      },

      "minItems": 1,
      "uniqueItems": true
    },

   "range": {
      "type": "array",

      "description": "Define a range of value: first value is lower bound, second is upper.",

      "items": [
        { "type": "number" },
	{ "type": "number" }
      ]
    },

   "scoreFilter": {
      "type": "object",

      "description": "The standard bed field of score, which is an integer will be used to filter items in the track. By default, items with scores below threshold will be excluded. If limits is specified, the threshold cannot be set outside the boundaries specified by limits.",

      "properties": {
        "threshold": { "type": "number" },

	"limits": { "$ref": "#/definitions/range" }
      },

      "required": ["threshold"]
    },

    "image_path": {
      "type": "object",

      "definition": "Items can be associated with images and the images can be made visible with these two settings. The itemImagepath specifies a URL path to a directory with image files named in the format {name}.{suffix}. The name is retrieved from the table or remote data file. This image will be displayed on the item detaiIs page. If itemBigImagePath is also supplied, then a link to a larger image will be provided. If the path provided is local to the browser then the path should be relative.",

      "properties": {
        "path": { "type": "string" },

	"suffix": { "type": "string" }
      }
    }

  }



}
